# Hibernate Lifecycle

## Theory

The Hibernate lifecycle describes the different states an entity can be in during its existence in a Hibernate-managed session. Understanding this lifecycle is crucial for managing the persistence of entities effectively.

### Hibernate Entity Lifecycle States

<img src="./HibernateLifecycle.png" width=400>

1. **Transient**

   - **Description**: An entity that is instantiated but not yet associated with a Hibernate session or database, so this state is not connected to any database table. It has not been persisted and does not have an identifier assigned.
   - **Example**:
     ```java
     User user = new User(); // Transient state
     ```
   - There are two ways in which transient state will occur as follows:

     1. When objects are generated by an application but are not connected to any session.
     2. The objects are generated by a closed session.

2. **Persistent**

   - **Description**: An entity that is associated with a Hibernate session and is stored in the database. Changes made to this entity are automatically synchronized with the database when the session is flushed.
   - **Example**:
     ```java
     Session session = sessionFactory.openSession();
     session.beginTransaction();
     User user = new User(); // Transient
     session.save(user);    // Becomes Persistent
     session.getTransaction().commit();
     session.close();
     ```

3. **Detached**

   - **Description**: An entity that was once associated with a Hibernate session but has since been detached. This state occurs when the session is closed or when the entity is explicitly evicted from the session cache. Changes made to the detached entity are not automatically synchronized with the database.
   - **Example**:
     ```java
     Session session = sessionFactory.openSession();
     session.beginTransaction();
     User user = (User) session.get(User.class, userId); // Persistent
     session.getTransaction().commit();
     session.close(); // User is now Detached
     ```

4. **Removed**
   - **Description**: An entity that has been marked for deletion from the database. It is in the process of being removed, but the actual deletion occurs when the session is flushed.
   - **Example**:
     ```java
     Session session = sessionFactory.openSession();
     session.beginTransaction();
     User user = (User) session.get(User.class, userId); // Persistent
     session.delete(user); // User is now Removed
     session.getTransaction().commit();
     session.close();
     ```

### Key Points

- **Session Management**: To manage the lifecycle of entities effectively, you need to understand the session management practices, including opening, closing, and flushing sessions.
- **Automatic Synchronization**: Persistent entities are automatically synchronized with the database, while detached entities require explicit merging to synchronize changes.
- **Entity States**: The transition between states (Transient, Persistent, Detached, and Removed) is essential for understanding how changes are managed and propagated.

## Use Cases

- **Transient State**: When creating new entities that are not yet meant to be persisted in the database.
- **Persistent State**: For entities that are currently being managed by a Hibernate session, allowing changes to be automatically saved.
- **Detached State**: Useful for working with entities outside of the original session context, especially in cases of long-running processes.
- **Removed State**: When entities need to be deleted from the database, ensuring that the removal is handled during the session flush.

## Questions

1. What are the different states of an entity in Hibernate?
2. How does an entity transition from Transient to Persistent state?
3. What actions can cause an entity to move to the Detached state?
4. Explain how Hibernate manages entity removal.
5. How does session management affect entity lifecycle states?
